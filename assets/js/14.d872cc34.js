(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{202:function(s,t,a){"use strict";a.r(t);var n=a(0),e=Object(n.a)({},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"content"},[s._m(0),s._v(" "),a("BlogPostMeta"),s._v(" "),a("p"),s._m(1),a("p"),s._v(" "),s._m(2),s._v(" "),a("p",[s._v("两台服务器都要相互设置")]),s._v(" "),s._m(3),s._m(4),s._v(" "),s._m(5),s._v(" "),s._m(6),s._v(" "),s._m(7),a("ul",[a("li",[s._v("下载并安装 "),a("a",{attrs:{href:"https://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-5.7.24-1.el7.x86_64.rpm-bundle.tar",target:"_blank",rel:"noopener noreferrer"}},[s._v("MySQL5.7.24"),a("OutboundLink")],1)])]),s._v(" "),s._m(8),s._m(9),s._v(" "),s._m(10),s._v(" "),s._m(11),s._v(" "),s._m(12),s._m(13),s._v(" "),s._m(14),s._m(15),s._v(" "),s._m(16),s._v(" "),s._m(17),s._m(18),s._v(" "),s._m(19),s._m(20),s._v(" "),s._m(21),s._m(22),s._v(" "),s._m(23),s._m(24),s._v(" "),s._m(25),s._m(26),s._v(" "),s._m(27),s._m(28),s._v(" "),s._m(29),s._m(30),s._v(" "),s._m(31),s._v(" "),s._m(32),s._m(33),s._v(" "),s._m(34),s._v(" "),s._m(35),s._v(" "),s._m(36),s._m(37),s._v(" "),s._m(38),s._m(39),s._v(" "),s._m(40),s._m(41),s._v(" "),s._m(42),s._v(" "),s._m(43),s._v(" "),a("Valine")],1)},[function(){var s=this.$createElement,t=this._self._c||s;return t("h1",{attrs:{id:"centos7-5-mysql5-7-24-mha0-58高可用架构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#centos7-5-mysql5-7-24-mha0-58高可用架构","aria-hidden":"true"}},[this._v("#")]),this._v(" CentOS7.5+MySQL5.7.24+MHA0.58高可用架构")])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#设置各主机间免密登录"}},[s._v("设置各主机间免密登录")])]),a("li",[a("a",{attrs:{href:"#软件安装"}},[s._v("软件安装")]),a("ul",[a("li",[a("a",{attrs:{href:"#安装mysql-5-7-24"}},[s._v("安装MySQL 5.7.24")])]),a("li",[a("a",{attrs:{href:"#配置mysql主从环境"}},[s._v("配置MySQL主从环境")])]),a("li",[a("a",{attrs:{href:"#安装mha-0-58"}},[s._v("安装MHA 0.58")])]),a("li",[a("a",{attrs:{href:"#配置mha"}},[s._v("配置MHA")])])])]),a("li",[a("a",{attrs:{href:"#配置vip漂移"}},[s._v("配置VIP漂移")]),a("ul",[a("li",[a("a",{attrs:{href:"#mha脚本方式"}},[s._v("MHA脚本方式")])]),a("li",[a("a",{attrs:{href:"#keepalive方式"}},[s._v("keepalive方式")])])])])])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"设置各主机间免密登录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#设置各主机间免密登录","aria-hidden":"true"}},[this._v("#")]),this._v(" 设置各主机间免密登录")])},function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[this._v("ssh-keygen\nssh-copy-id -i /root/.ssh/id_rsa.pub root@192.168.0.45\nssh-copy-id -i /root/.ssh/id_rsa.pub root@192.168.0.5\n")])]),this._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[this._v("1")]),t("br"),t("span",{staticClass:"line-number"},[this._v("2")]),t("br"),t("span",{staticClass:"line-number"},[this._v("3")]),t("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"软件安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#软件安装","aria-hidden":"true"}},[this._v("#")]),this._v(" 软件安装")])},function(){var s=this.$createElement,t=this._self._c||s;return t("h3",{attrs:{id:"安装mysql-5-7-24"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装mysql-5-7-24","aria-hidden":"true"}},[this._v("#")]),this._v(" 安装MySQL 5.7.24")])},function(){var s=this.$createElement,t=this._self._c||s;return t("ul",[t("li",[this._v("删除系统自带的Mariadb数据库")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[this._v("rpm -qa"),t("span",{pre:!0,attrs:{class:"token operator"}},[this._v("|")]),t("span",{pre:!0,attrs:{class:"token function"}},[this._v("grep")]),this._v(" mariadb\nrpm -e --nodeps mariadb-libs-5.5.56-2.el7.x86_64\n")])]),this._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[this._v("1")]),t("br"),t("span",{staticClass:"line-number"},[this._v("2")]),t("br")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -xf mysql-5.7.24-1.el7.x86_64.rpm-bundle.tar\nrpm -ivh mysql-community-common-5.7.24-1.el7.x86_64.rpm \nrpm -ivh mysql-community-libs-5.7.24-1.el7.x86_64.rpm\nrpm -ivh mysql-community-client-5.7.24-1.el7.x86_64.rpm\nrpm -ivh mysql-community-server-5.7.24-1.el7.x86_64.rpm \nrpm -ivh mysql-community-libs-compat-5.7.24-1.el7.x86_64.rpm\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("ul",[t("li",[this._v("MySQL目录")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("blockquote",[t("p",[this._v("数据库目录：/var/lib/mysql/\n命令配置：/usr/share/mysql  (mysql.server命令及配置文件)\n相关命令：/usr/bin   (mysqladmin mysqldump等命令)\n启动脚本：/etc/rc.d/init.d/   (启动脚本文件mysql的目录)\n系统配置：/etc/my.conf")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("ul",[t("li",[this._v("设置密码")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /var/log/mysqld.log "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取默认密码")]),s._v("\nmysql -u root -p\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" password "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" password"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'你的密码'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ngrant all privileges on *.* to "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'root'")]),s._v(" @"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%'")]),s._v(" identified by "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'你的密码'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nflush privileges"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("ul",[t("li",[this._v("开机自启")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[this._v("chkconfig")]),this._v(" mysqld on\n")])]),this._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[this._v("1")]),t("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h3",{attrs:{id:"配置mysql主从环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置mysql主从环境","aria-hidden":"true"}},[this._v("#")]),this._v(" 配置MySQL主从环境")])},function(){var s=this.$createElement,t=this._self._c||s;return t("ul",[t("li",[this._v("MySQL主节点的配置如下:")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysqld"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nlog-bin"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mysql-bin \nserver-id"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("1\ncharacter-set-server"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf8\ninit_connect"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'SET AUTOCOMMIT=0;set names utf8'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("ul",[t("li",[this._v("MySQL从节点的配置如下")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysqld"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nlog-bin"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mysql-bin \nserver-id"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("2\ncharacter-set-server"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf8\ninit_connect"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'SET AUTOCOMMIT=0;set names utf8'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("ul",[t("li",[this._v("创建需要复制的用户")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("CREATE USER "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'repl'")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'192.168.0.5'")]),s._v(" IDENTIFIED BY "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'密码'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nGRANT REPLICATION SLAVE ON *.* TO "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'repl'")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'192.168.0.5'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("ul",[t("li",[this._v("同步数据")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" FLUSH TABLES WITH READ LOCK"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将主库锁定")]),s._v("\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" show master status"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nmysqldump --all-databases --master-data -u root -p "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" school.sql "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#备份主库")]),s._v("\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" unlock tables"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#解锁")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" school.sql root@192.168.0.5:/data/mysql "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#同步数据")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("ul",[t("li",[this._v("从库开启主从复制")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("mysql -u root -p "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/data/mysql/school.sql \nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" change master to master_host "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'192.168.0.45'")]),s._v(",master_port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("3306,master_user"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'repl'")]),s._v(",master_password"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'密码'")]),s._v(",master_log_file"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mysql-bin.000002'")]),s._v(",master_log_pos"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("154"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" start slave"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("ul",[t("li",[this._v("设置mysql程序及binglog程序的软连接")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[this._v("ln")]),this._v(" -s /usr/local/mysql/bin/mysql /usr/bin/mysql\n"),t("span",{pre:!0,attrs:{class:"token function"}},[this._v("ln")]),this._v(" -s /usr/local/mysql/bin/mysqlbinlog /usr/local/bin/mysqlbinlog\n")])]),this._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[this._v("1")]),t("br"),t("span",{staticClass:"line-number"},[this._v("2")]),t("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h3",{attrs:{id:"安装mha-0-58"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装mha-0-58","aria-hidden":"true"}},[this._v("#")]),this._v(" 安装MHA 0.58")])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#先安装依赖")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" http://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm\nrpm -ivh epel-release-latest-7.noarch.rpm\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://www.percona.com/downloads/Percona-XtraDB-Cluster-LATEST/Percona-XtraDB-Cluster-5.7.24-31.33/binary/redhat/7/x86_64/Percona-XtraDB-Cluster-shared-57-5.7.24-31.33.1.el7.x86_64.rpm\nrpm -ivh Percona-XtraDB-Cluster-shared-57-5.7.24-31.33.1.el7.x86_64.rpm \nyum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" perl-DBD-MySQL perl-Config-Tiny perl-Log-Dispatch perl-Parallel-ForkManager　-y\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://github.com/yoshinorim/mha4mysql-node/releases/download/v0.58/mha4mysql-node-0.58-0.el7.centos.noarch.rpm\nrpm -ivh mha4mysql-node-0.58-0.el7.centos.noarch.rpm\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#仅在manager节点上安装mha管理软件")]),s._v("\nyum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" perl-Parallel-ForkManager  \n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://github.com/yoshinorim/mha4mysql-manager/releases/download/v0.58/mha4mysql-manager-0.58-0.el7.centos.noarch.rpm\nrpm -ivh mha4mysql-manager-0.58-0.el7.centos.noarch.rpm\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h3",{attrs:{id:"配置mha"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置mha","aria-hidden":"true"}},[this._v("#")]),this._v(" 配置MHA")])},function(){var s=this.$createElement,t=this._self._c||s;return t("ul",[t("li",[this._v("创建配置文件")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("server default"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" \nuser"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("root \npassword"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("数据库密码\nssh_user"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("root \nmanager_workdir"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/data/mha/manager\nremote_workdir"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/tmp\nrepl_user"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("repl \nrepl_password"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("数据库密码\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("server1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" \nhostname"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("192.168.0.45\nport"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("3306\nmaster_binlog_dir"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/lib/mysql\n \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("server2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" \nhostname"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("192.168.0.5\nport"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("3306 \nmaster_binlog_dir"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/lib/mysql\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("ul",[t("li",[this._v("MHA主要配置文件说明")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("blockquote",[t("p",[this._v('manager_workdir=/var/log/masterha/app1.log：设置manager的工作目录     \nmanager_log=/var/log/masterha/app1/manager.log：设置manager的日志文件  \nmaster_binlog_dir=/data/mysql：设置master 保存binlog的位置，以便MHA可以找到master的日志                      \nmaster_ip_failover_script= /usr/local/bin/master_ip_failover：设置自动failover时候的切换脚本\nmaster_ip_online_change_script= /usr/local/bin/master_ip_online_change：设置手动切换时候的切换脚本 \nuser=root：设置监控mysql的用户\npassword=manager123：设置监控mysql的用户，需要授权能够在manager节点远程登录\nping_interval=1：设置监控主库，发送ping包的时间间隔，默认是3秒，尝试三次没有回应的时候自动进行railover    \nremote_workdir=/tmp：设置远端mysql在发生切换时binlog的保存位置\nrepl_user=repl ：设置mysql中用于复制的用户密码\nrepl_password=repl：设置mysql中用于复制的用户        \nreport_script=/usr/local/send_report：设置发生切换后发送的报警的脚本 \nshutdown_script=""：设置故障发生后关闭故障主机脚本（该脚本的主要作用是关闭主机放在发生脑裂,这里没有使用）\nssh_user=root //设置ssh的登录用户名\ncandidate_master=1：在节点下设置，设置当前节点为候选的master\nslave check_repl_delay=0 :在节点配置下设置，默认情况下如果一个slave落后master 100M的relay logs的话，MHA将不会选择该slave作为一个新的master；这个选项对于对于设置了candidate_master=1的主机非常有用')])])},function(){var s=this.$createElement,t=this._self._c||s;return t("ul",[t("li",[this._v("用masterha_check_ssh检测SSH连接是否配置正常")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@server-0004 manager"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# masterha_check_ssh --conf=/data/mha/manager/manager.conf")]),s._v("\nWed Jan  9 17:59:08 2019 - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("warning"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Global configuration "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" /etc/masterha_default.cnf not found. Skipping.\nWed Jan  9 17:59:08 2019 - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("info"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Reading application default configuration from /data/mha/manager/manager.conf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\nWed Jan  9 17:59:08 2019 - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("info"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Reading server configuration from /data/mha/manager/manager.conf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\nWed Jan  9 17:59:08 2019 - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("info"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Starting SSH connection tests"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\nWed Jan  9 17:59:09 2019 - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("debug"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" \nWed Jan  9 17:59:08 2019 - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("debug"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  Connecting via SSH from root@192.168.0.45"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("192.168.0.45:22"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" to root@192.168.0.5"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("192.168.0.5:22"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\nWed Jan  9 17:59:09 2019 - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("debug"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("   ok.\nWed Jan  9 17:59:09 2019 - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("debug"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" \nWed Jan  9 17:59:09 2019 - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("debug"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  Connecting via SSH from root@192.168.0.5"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("192.168.0.5:22"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" to root@192.168.0.45"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("192.168.0.45:22"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\nWed Jan  9 17:59:09 2019 - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("debug"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("   ok.\nWed Jan  9 17:59:09 2019 - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("info"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" All SSH connection tests passed successfully.\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("ul",[t("li",[this._v("用masterha_check_repl检测复制配置是否正确")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[this._v("masterha_check_repl --conf"),t("span",{pre:!0,attrs:{class:"token operator"}},[this._v("=")]),this._v("/data/mha/manager/manager.conf\n")])]),this._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[this._v("1")]),t("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("ul",[t("li",[this._v("启动manager")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" masterha_manager --conf"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/data/mha/manager/manager.conf "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /var/log/mha_manager.log "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" /dev/null "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检测运行状态")]),s._v("\nmasterha_check_status --conf"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/data/mha/manager/manager.conf\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 停止")]),s._v("\nmasterha_stop --conf"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/data/mha/manager/manager.conf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"配置vip漂移"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置vip漂移","aria-hidden":"true"}},[this._v("#")]),this._v(" 配置VIP漂移")])},function(){var s=this.$createElement,t=this._self._c||s;return t("h3",{attrs:{id:"mha脚本方式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mha脚本方式","aria-hidden":"true"}},[this._v("#")]),this._v(" MHA脚本方式")])},function(){var s=this.$createElement,t=this._self._c||s;return t("h3",{attrs:{id:"keepalive方式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#keepalive方式","aria-hidden":"true"}},[this._v("#")]),this._v(" keepalive方式")])}],!1,null,null,null);e.options.__file="mysql-mha.md";t.default=e.exports}}]);