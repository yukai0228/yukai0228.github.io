(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{196:function(s,a,e){"use strict";e.r(a);var t=e(0),n=Object(t.a)({},function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("div",{staticClass:"content"},[s._m(0),s._v(" "),e("BlogPostMeta"),s._v(" "),e("p"),s._m(1),e("p"),s._v(" "),s._m(2),s._v(" "),s._m(3),s._m(4),s._v(" "),s._m(5),s._m(6),s._v(" "),s._m(7),s._m(8),s._v(" "),s._m(9),e("p",[s._v("记住最后输出的节点加入指令")]),s._v(" "),s._m(10),s._m(11),s._v(" "),s._m(12),s._m(13),s._v(" "),s._m(14),s._v(" "),s._m(15),e("p",[s._v("kube-proxy.kubeconfig文件内容如下：")]),s._v(" "),s._m(16),e("p",[s._v("信任goodrain容器仓库\n在/etc/docker/daemon.json加入如下配置,注意放在第一行")]),s._v(" "),s._m(17),e("p",[s._v("重启docker")]),s._v(" "),s._m(18),e("p",[s._v("初始化rainbond数据中心")]),s._v(" "),s._m(19),e("p",[s._v("rainbond节点加入,需要各主机间配置免密登录")]),s._v(" "),s._m(20),e("Valine")],1)},[function(){var s=this.$createElement,a=this._self._c||s;return a("h1",{attrs:{id:"k8s-goodrain-环境搭建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#k8s-goodrain-环境搭建","aria-hidden":"true"}},[this._v("#")]),this._v(" k8s + goodrain 环境搭建")])},function(){var s=this.$createElement,a=this._self._c||s;return a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#安装docker和k8s集群环境"}},[this._v("安装docker和k8s集群环境")])]),a("li",[a("a",{attrs:{href:"#配置docker文件驱动"}},[this._v("配置docker文件驱动")])]),a("li",[a("a",{attrs:{href:"#安装kubeadm等环境"}},[this._v("安装kubeadm等环境")])]),a("li",[a("a",{attrs:{href:"#kubeadm-master节点初始化"}},[this._v("kubeadm master节点初始化")])]),a("li",[a("a",{attrs:{href:"#k8s节点初始化"}},[this._v("k8s节点初始化")])]),a("li",[a("a",{attrs:{href:"#k8s主节点配置好雨环境文件"}},[this._v("k8s主节点配置好雨环境文件")])])])])},function(){var s=this.$createElement,a=this._self._c||s;return a("h2",{attrs:{id:"安装docker和k8s集群环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装docker和k8s集群环境","aria-hidden":"true"}},[this._v("#")]),this._v(" 安装docker和k8s集群环境")])},function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("systemctl stop firewalld.service\nsystemctl disable firewalld.service\nyum "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y yum-utils\nyum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo\nyum list docker-ce --showduplicates "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sort")]),s._v(" -r\nyum "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" docker-ce -y\nsystemctl start docker "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" systemctl "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("enable")]),s._v(" docker\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])])},function(){var s=this.$createElement,a=this._self._c||s;return a("h2",{attrs:{id:"配置docker文件驱动"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置docker文件驱动","aria-hidden":"true"}},[this._v("#")]),this._v(" 配置docker文件驱动")])},function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/docker/daemon.json "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('EOF\n{\n  "exec-opts": ["native.cgroupdriver=systemd"],\n  "log-driver": "json-file",\n  "log-opts": {\n    "max-size": "100m"\n  },\n  "storage-driver": "overlay2",\n  "storage-opts": [\n    "overlay2.override_kernel_check=true"\n  ]\n}\nEOF')]),s._v("\nsystemctl daemon-reload\nsystemctl restart docker\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br")])])},function(){var s=this.$createElement,a=this._self._c||s;return a("h2",{attrs:{id:"安装kubeadm等环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装kubeadm等环境","aria-hidden":"true"}},[this._v("#")]),this._v(" 安装kubeadm等环境")])},function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v("EOF "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/yum.repos.d/kubernetes.repo\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kubernetes"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nname"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Kubernetes\nbaseurl"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64\nenabled"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("1\ngpgcheck"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("1\nrepo_gpgcheck"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("1\ngpgkey"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg\nexclude"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kube*\nEOF\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Set SELinux in permissive mode (effectively disabling it)")]),s._v("\nsetenforce 0\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/^SELINUX=enforcing$/SELINUX=permissive/'")]),s._v(" /etc/selinux/config\n\nyum "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y kubelet kubeadm kubectl --disableexcludes"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kubernetes\n\nsystemctl "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("enable")]),s._v(" --now kubelet\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br")])])},function(){var s=this.$createElement,a=this._self._c||s;return a("h2",{attrs:{id:"kubeadm-master节点初始化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kubeadm-master节点初始化","aria-hidden":"true"}},[this._v("#")]),this._v(" kubeadm master节点初始化")])},function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kubeadm config images list "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -e "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/^/docker pull /g'")]),s._v(" -e "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s#k8s.gcr.io#registry.cn-hangzhou.aliyuncs.com/google_containers#g'")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" sh -x\ndocker images "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" registry.cn-hangzhou.aliyuncs.com/google_containers "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'{print "docker tag",'),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v('":"'),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$2")]),s._v(","),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v('":"'),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$2")]),s._v("}'")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -e "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/registry.cn-hangzhou.aliyuncs.com\\/google_containers/k8s.gcr.io/2'")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" sh -x\ndocker images "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" registry.cn-hangzhou.aliyuncs.com/google_containers "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'{print "docker rmi """'),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v('""":"""'),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$2")]),s._v("}'")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" sh -x\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("echo")]),s._v(" 1 "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /proc/sys/net/ipv4/ip_forward\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("echo")]),s._v(" 1 "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /proc/sys/net/bridge/bridge-nf-call-iptables\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("echo")]),s._v(" 1 "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /proc/sys/net/bridge/bridge-nf-call-ip6tables\nswapoff -a\nkubeadm init --pod-network-cidr"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("10.244.0.0/16\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("export")]),s._v(" KUBECONFIG"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/kubernetes/admin.conf\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装flannel 网络插件使得节点可以互相通信")]),s._v("\nkubectl apply -f https://raw.githubusercontent.com/coreos/flannel/a70459be0084506e4ec919aa1c114638878db11b/Documentation/kube-flannel.yml\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])])},function(){var s=this.$createElement,a=this._self._c||s;return a("div",{staticClass:"language-bashc line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[this._v("kubeadm join 192.168.102.151:6443 --token uib759.7e38mk96vncbm8az \\\n    --discovery-token-ca-cert-hash sha256:aa2ff4df2b038e3114f40d66bccee26b6843b3c25a23e52321c167d22c38db6c\n\n")])]),this._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[this._v("1")]),a("br"),a("span",{staticClass:"line-number"},[this._v("2")]),a("br"),a("span",{staticClass:"line-number"},[this._v("3")]),a("br")])])},function(){var s=this.$createElement,a=this._self._c||s;return a("h2",{attrs:{id:"k8s节点初始化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#k8s节点初始化","aria-hidden":"true"}},[this._v("#")]),this._v(" k8s节点初始化")])},function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kubeadm config images list "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -e "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/^/docker pull /g'")]),s._v(" -e "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s#k8s.gcr.io#registry.cn-hangzhou.aliyuncs.com/google_containers#g'")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" sh -x\ndocker images "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" registry.cn-hangzhou.aliyuncs.com/google_containers "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'{print "docker tag",'),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v('":"'),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$2")]),s._v(","),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v('":"'),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$2")]),s._v("}'")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -e "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/registry.cn-hangzhou.aliyuncs.com\\/google_containers/k8s.gcr.io/2'")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" sh -x\ndocker images "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" registry.cn-hangzhou.aliyuncs.com/google_containers "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'{print "docker rmi """'),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v('""":"""'),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$2")]),s._v("}'")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" sh -x\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("echo")]),s._v(" 1 "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /proc/sys/net/ipv4/ip_forward\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("echo")]),s._v(" 1 "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /proc/sys/net/bridge/bridge-nf-call-iptables\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("echo")]),s._v(" 1 "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /proc/sys/net/bridge/bridge-nf-call-ip6tables\nswapoff -a\nkubeadm "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),s._v(" 192.168.0.233:6443 --token egvj6m.r2vjmxivtws1qow5 \\\n    --discovery-token-ca-cert-hash sha256:8f7ec26cc69de8dafb6673122954b9c4bed324d2caf65aaaee71804583fb0319 \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])])},function(){var s=this.$createElement,a=this._self._c||s;return a("h2",{attrs:{id:"k8s主节点配置好雨环境文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#k8s主节点配置好雨环境文件","aria-hidden":"true"}},[this._v("#")]),this._v(" k8s主节点配置好雨环境文件")])},function(){var s=this.$createElement,a=this._self._c||s;return a("p",[this._v("新建目录"),a("code",[this._v("/opt/rainbond/etc/kubernetes/kubecfg")]),this._v(",里面放入admin.kubeconfig和kube-proxy.kubeconfig文件")])},function(){var s=this.$createElement,a=this._self._c||s;return a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[this._v("cp")]),this._v(" /etc/kubernetes/admin.conf /opt/rainbond/etc/kubernetes/kubecfg/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[this._v("mv")]),this._v(" admin.conf admin.kubeconfig\n")])]),this._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[this._v("1")]),a("br"),a("span",{staticClass:"line-number"},[this._v("2")]),a("br")])])},function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kube-proxy.kubeconfig")]),s._v("\napiVersion: v1\nkind: Config\nclusters:\n- cluster:\n    certificate-authority: "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("base64 ca.crt证书内容"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    server: "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("kube api https地址"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  name: default\ncontexts:\n- context:\n    cluster: default\n    namespace: default\n    user: default\n  name: default\ncurrent-context: default\nusers:\n- name: default\n  user:\n    token: "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("token"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ca.crt 文件：/etc/kubernetes/pki/ca.crt ")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如 base64 /etc/kubernetes/pki/ca.crt > ca.txt")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# token 获取方式")]),s._v("\nkubectl -n kube-system get secret "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" kube-proxy "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'{print "secret/"'),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v("}'")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("xargs")]),s._v(" kubectl describe -n kube-system "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" token: "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" -F: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$2")]),s._v("}'")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("xargs")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("echo")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br")])])},function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"insecure-registries"')]),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"goodrain.me"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])])},function(){var s=this.$createElement,a=this._self._c||s;return a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[this._v("systemctl daemon-reload\nsystemctl restart docker\n")])]),this._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[this._v("1")]),a("br"),a("span",{staticClass:"line-number"},[this._v("2")]),a("br")])])},function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://pkg.rainbond.com/releases/common/v5.1/grctl\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x ./grctl\n./grctl init --iip 192.168.102.151 --deploy-type thirdparty \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])])},function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# worker节点NAME，通过如下命令获取")]),s._v("\nkubectl get node -o wide \n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加已有k8s worker计算节点")]),s._v("\ngrctl node add --host "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("worker节点hostname"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" --iip "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("worker内网ip"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" --key /root/.ssh/id_rsa.pub --role compute --id "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("worker节点NAME"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\ngrctl node "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("worker节点NAME"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加已有k8s master管理节点")]),s._v("\ngrctl node add --host "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("master节点hostname"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" --iip "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("worker内网ip"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" --key /root/.ssh/id_rsa.pub --role manage --id "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("master节点NAME"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\ngrctl node "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("master节点NAME"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br")])])}],!1,null,null,null);n.options.__file="k8s + goodrain 环境搭建.md";a.default=n.exports}}]);