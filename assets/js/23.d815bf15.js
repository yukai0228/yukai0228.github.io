(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{188:function(s,a,e){"use strict";e.r(a);var t=e(0),n=Object(t.a)({},function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("div",{staticClass:"content"},[s._m(0),s._v(" "),e("BlogPostMeta"),s._v(" "),e("p"),s._m(1),e("p"),s._v(" "),s._m(2),s._v(" "),e("p",[s._v("1号 10.170.0.3\n2号 10.170.0.4\n3号 10.170.0.5")]),s._v(" "),s._m(3),s._v(" "),e("p",[s._v("在所有节点上安装以下环境")]),s._v(" "),s._m(4),s._m(5),s._v(" "),e("p",[s._v("在1号主机执行")]),s._v(" "),s._m(6),e("p",[s._v("执行完后获取信息")]),s._v(" "),s._m(7),s._m(8),s._v(" "),e("p",[s._v("在2号主机和3号主机运行之前kubeadm init 最后的输出代码")]),s._v(" "),s._m(9),e("Valine")],1)},[function(){var s=this.$createElement,a=this._self._c||s;return a("h1",{attrs:{id:"kubeadm安装k8s集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kubeadm安装k8s集群","aria-hidden":"true"}},[this._v("#")]),this._v(" Kubeadm安装K8s集群")])},function(){var s=this.$createElement,a=this._self._c||s;return a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#服务器"}},[this._v("服务器")])]),a("li",[a("a",{attrs:{href:"#kubelet安装"}},[this._v("kubelet安装")])]),a("li",[a("a",{attrs:{href:"#kubeadm-初始化"}},[this._v("kubeadm 初始化")])]),a("li",[a("a",{attrs:{href:"#节点加入"}},[this._v("节点加入")])])])])},function(){var s=this.$createElement,a=this._self._c||s;return a("h2",{attrs:{id:"服务器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务器","aria-hidden":"true"}},[this._v("#")]),this._v(" 服务器")])},function(){var s=this.$createElement,a=this._self._c||s;return a("h2",{attrs:{id:"kubelet安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kubelet安装","aria-hidden":"true"}},[this._v("#")]),this._v(" kubelet安装")])},function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("systemctl stop firewalld.service\nsystemctl disable firewalld.service\nyum "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y yum-utils\nyum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo\nyum list docker-ce --showduplicates "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sort")]),s._v(" -r\nyum "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" docker-ce -y\nsystemctl start docker "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" systemctl "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("enable")]),s._v(" docker\n\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /etc/docker\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Setup daemon.")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/docker/daemon.json "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('EOF\n{\n  "exec-opts": ["native.cgroupdriver=systemd"],\n  "log-driver": "json-file",\n  "log-opts": {\n    "max-size": "100m"\n  },\n  "storage-driver": "overlay2",\n  "storage-opts": [\n    "overlay2.override_kernel_check=true"\n  ]\n}\nEOF')]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /etc/systemd/system/docker.service.d\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Restart Docker")]),s._v("\nsystemctl daemon-reload\nsystemctl restart docker\n\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v("EOF "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/yum.repos.d/kubernetes.repo\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kubernetes"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nname"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Kubernetes\nbaseurl"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64\nenabled"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("1\ngpgcheck"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("1\nrepo_gpgcheck"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("1\ngpgkey"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg\nexclude"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kube*\nEOF\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Set SELinux in permissive mode (effectively disabling it)")]),s._v("\nsetenforce 0\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/^SELINUX=enforcing$/SELINUX=permissive/'")]),s._v(" /etc/selinux/config\n\nyum "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y kubelet kubeadm kubectl --disableexcludes"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kubernetes\n\nsystemctl "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("enable")]),s._v(" --now kubelet\n\n\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br"),e("span",{staticClass:"line-number"},[s._v("51")]),e("br"),e("span",{staticClass:"line-number"},[s._v("52")]),e("br")])])},function(){var s=this.$createElement,a=this._self._c||s;return a("h2",{attrs:{id:"kubeadm-初始化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kubeadm-初始化","aria-hidden":"true"}},[this._v("#")]),this._v(" kubeadm 初始化")])},function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行脚本来拉取镜像")]),s._v("\nkubeadm config images list "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -e "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/^/docker pull /g'")]),s._v(" -e "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s#k8s.gcr.io#registry.cn-hangzhou.aliyuncs.com/google_containers#g'")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" sh -x\ndocker images "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" registry.cn-hangzhou.aliyuncs.com/google_containers "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'{print "docker tag",'),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v('":"'),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$2")]),s._v(","),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v('":"'),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$2")]),s._v("}'")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -e "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/registry.cn-hangzhou.aliyuncs.com\\/google_containers/k8s.gcr.io/2'")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" sh -x\ndocker images "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" registry.cn-hangzhou.aliyuncs.com/google_containers "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'{print "docker rmi """'),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v('""":"""'),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$2")]),s._v("}'")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" sh -x\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("echo")]),s._v(" 1 "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /proc/sys/net/bridge/bridge-nf-call-iptables\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("echo")]),s._v(" 1 "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /proc/sys/net/bridge/bridge-nf-call-ip6tables\nswapoff -a\nkubeadm init --pod-network-cidr"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("10.244.0.0/16\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("export")]),s._v(" KUBECONFIG"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/kubernetes/admin.conf\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装flannel 网络插件使得节点可以互相通信")]),s._v("\nkubectl apply -f https://raw.githubusercontent.com/coreos/flannel/a70459be0084506e4ec919aa1c114638878db11b/Documentation/kube-flannel.yml\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])])},function(){var s=this.$createElement,a=this._self._c||s;return a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[this._v("kubeadm "),a("span",{pre:!0,attrs:{class:"token function"}},[this._v("join")]),this._v(" 172.16.1.151:6443 --token 4pnpyx.8hf86hmqnn8vbrvi \\\n    --discovery-token-ca-cert-hash sha256:d05d3da8c702394e62b73acb35bcada8f90b9715b9a46fdb380e9bd30f504664 \n")])]),this._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[this._v("1")]),a("br"),a("span",{staticClass:"line-number"},[this._v("2")]),a("br")])])},function(){var s=this.$createElement,a=this._self._c||s;return a("h2",{attrs:{id:"节点加入"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#节点加入","aria-hidden":"true"}},[this._v("#")]),this._v(" 节点加入")])},function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kubeadm config images list "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -e "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/^/docker pull /g'")]),s._v(" -e "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s#k8s.gcr.io#registry.cn-hangzhou.aliyuncs.com/google_containers#g'")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" sh -x\ndocker images "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" registry.cn-hangzhou.aliyuncs.com/google_containers "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'{print "docker tag",'),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v('":"'),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$2")]),s._v(","),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v('":"'),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$2")]),s._v("}'")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -e "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/registry.cn-hangzhou.aliyuncs.com\\/google_containers/k8s.gcr.io/2'")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" sh -x\ndocker images "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" registry.cn-hangzhou.aliyuncs.com/google_containers "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'{print "docker rmi """'),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v('""":"""'),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$2")]),s._v("}'")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" sh -x\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("echo")]),s._v(" 1 "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /proc/sys/net/bridge/bridge-nf-call-iptables\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("echo")]),s._v(" 1 "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /proc/sys/net/bridge/bridge-nf-call-ip6tables\nswapoff -a\nkubeadm "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),s._v(" 172.16.1.151:6443 --token jcuqi0.pmg29b19vuynke88 \\\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("     --discovery-token-ca-cert-hash sha256:230201f89bd01c0c09bd6ac01a349a2ebb7ee161a2e8a7f36091d652b31d54ce \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])])}],!1,null,null,null);n.options.__file="kubeadm.md";a.default=n.exports}}]);